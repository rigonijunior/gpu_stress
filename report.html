<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GPU Stress â€” RelatÃ³rios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;900&family=JetBrains+Mono:wght@400;600&display=swap");
      body {
        font-family: "Inter", sans-serif;
      }
      .mono {
        font-family: "JetBrains Mono", monospace;
      }
      .glass {
        background: rgba(15, 23, 42, 0.8);
        backdrop-filter: blur(16px);
        border: 1px solid rgba(148, 163, 184, 0.1);
      }
      .glass-card {
        background: rgba(30, 41, 59, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(148, 163, 184, 0.08);
      }
      .gradient-text {
        background: linear-gradient(135deg, #60a5fa, #a78bfa, #f472b6);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .heatmap-row {
        display: flex;
        gap: 1px;
        height: 28px;
      }
      .heatmap-row div {
        flex: 1;
        border-radius: 2px;
        min-width: 2px;
        transition: transform 0.1s;
      }
      .heatmap-row div:hover {
        transform: scaleY(1.4);
        z-index: 1;
      }
      @keyframes fadeUp {
        from {
          opacity: 0;
          transform: translateY(16px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .fade-up {
        animation: fadeUp 0.4s ease-out forwards;
        opacity: 0;
      }
      .chart-box {
        height: 280px;
      }
      #file-list-view,
      #report-view {
        display: none;
      }
    </style>
    <script>
      tailwind.config = { darkMode: "class" };
    </script>
  </head>
  <body class="dark bg-[#0a0e1a] text-slate-200 min-h-screen">
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FILE LIST VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="file-list-view" class="max-w-3xl mx-auto px-4 py-12">
      <h1 class="text-4xl font-black gradient-text text-center mb-2">
        ğŸ”¥ GPU Stress Reports
      </h1>
      <p class="text-slate-500 text-center mb-10">
        Selecione um relatÃ³rio para visualizar
      </p>

      <div id="report-list" class="space-y-3"></div>

      <div class="mt-8 text-center">
        <label
          class="inline-flex items-center gap-2 px-6 py-3 rounded-xl bg-slate-800 hover:bg-slate-700 cursor-pointer transition border border-slate-700"
        >
          <span>ğŸ“ Ou carregue um arquivo JSON</span>
          <input type="file" accept=".json" id="file-input" class="hidden" />
        </label>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• REPORT VIEW â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div id="report-view" class="max-w-7xl mx-auto px-4 py-8">
      <!-- Back button -->
      <button
        onclick="showFileList()"
        class="mb-6 text-slate-500 hover:text-slate-300 transition flex items-center gap-2"
      >
        â† Voltar Ã  lista
      </button>

      <!-- Header -->
      <header class="glass rounded-2xl p-6 md:p-8 mb-8">
        <div
          class="flex flex-col md:flex-row md:items-center md:justify-between gap-4"
        >
          <div>
            <h1 class="text-3xl md:text-4xl font-black gradient-text mb-2">
              ğŸ”¥ GPU Stress Report
            </h1>
            <p class="text-slate-400 text-lg" id="hdr-subtitle"></p>
          </div>
          <div
            id="hdr-verdict"
            class="px-6 py-3 rounded-xl text-xl font-bold text-center"
          ></div>
        </div>
      </header>

      <!-- Summary Cards -->
      <div
        class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8"
        id="summary-cards"
      ></div>

      <!-- GPU Sections -->
      <div id="gpu-sections" class="space-y-8"></div>

      <!-- Footer -->
      <footer
        class="mt-12 mb-8 text-center text-slate-600 text-sm"
        id="footer-info"
      ></footer>
    </div>

    <script>
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• CONSTANTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      const MODE_LABELS = {
        compute: "Compute (CUDA Cores)",
        vram: "VRAM (MemÃ³ria)",
        mix: "Misto (Compute+VRAM)",
        pcie: "PCIe / NVLink",
        transient: "Picos de Energia",
        nvenc: "NVENC / VÃ­deo",
        training: "Treinamento IA",
        precision: "PrecisÃ£o FP64/INT8",
        all_sequential: "Todos em SequÃªncia",
      };

      let REPORT = null;

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HELPERS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function fmtDur(s) {
        const h = Math.floor(s / 3600),
          m = Math.floor((s % 3600) / 60),
          sec = Math.floor(s % 60);
        return (h > 0 ? h + "h " : "") + m + "m " + sec + "s";
      }
      function fmtDate(iso) {
        try {
          return new Date(iso).toLocaleString("pt-BR");
        } catch {
          return iso;
        }
      }
      function calcStats(vals) {
        if (!vals.length) return { min: 0, max: 0, avg: 0 };
        const mn = Math.min(...vals),
          mx = Math.max(...vals);
        return {
          min: mn,
          max: mx,
          avg:
            Math.round((vals.reduce((a, b) => a + b, 0) / vals.length) * 10) /
            10,
        };
      }
      function gpuSnaps(idx) {
        const out = [];
        for (const s of REPORT.snapshots || [])
          for (const g of s.gpus || [])
            if (g.idx === idx) out.push({ ...g, elapsed_s: s.elapsed_s });
        return out;
      }
      function tempColor(t) {
        if (t >= 90)
          return {
            txt: "text-red-400",
            bg: "bg-red-500/20",
            border: "border-red-500/30",
          };
        if (t >= 80)
          return {
            txt: "text-yellow-400",
            bg: "bg-yellow-500/20",
            border: "border-yellow-500/30",
          };
        if (t >= 70)
          return {
            txt: "text-orange-400",
            bg: "bg-orange-500/20",
            border: "border-orange-500/30",
          };
        if (t >= 60)
          return {
            txt: "text-green-400",
            bg: "bg-green-500/20",
            border: "border-green-500/30",
          };
        return {
          txt: "text-cyan-400",
          bg: "bg-cyan-500/20",
          border: "border-cyan-500/30",
        };
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FILE LIST â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      async function init() {
        try {
          const resp = await fetch("log/index.json");
          if (!resp.ok) throw new Error("no index");
          const index = await resp.json();
          showFileListView(index);
        } catch {
          // No index.json â€” show file picker only
          document.getElementById("file-list-view").style.display = "block";
          document.getElementById("report-list").innerHTML =
            '<p class="text-slate-500 text-center">Nenhum relatÃ³rio encontrado em <code class="mono text-xs">log/</code>.<br>Use o botÃ£o abaixo para carregar um JSON manualmente.</p>';
        }
      }

      function showFileListView(index) {
        const view = document.getElementById("file-list-view");
        const list = document.getElementById("report-list");
        view.style.display = "block";
        document.getElementById("report-view").style.display = "none";
        list.innerHTML = "";

        const files = (index.reports || []).slice().reverse(); // newest first
        files.forEach((r, i) => {
          const mode = MODE_LABELS[r.mode] || r.mode || "?";
          const date = r.date ? fmtDate(r.date) : r.file;
          const result = r.result || "";
          let badge = "ğŸŸ¢",
            badgeClass = "text-green-400";
          if (result.includes("ABORTADO")) {
            badge = "ğŸ”´";
            badgeClass = "text-red-400";
          } else if (result.includes("Interrompido")) {
            badge = "ğŸŸ¡";
            badgeClass = "text-yellow-400";
          }

          const el = document.createElement("div");
          el.className =
            "glass-card rounded-xl p-4 hover:bg-slate-700/40 cursor-pointer transition fade-up flex items-center gap-4";
          el.style.animationDelay = i * 0.04 + "s";
          el.innerHTML = `
            <span class="text-2xl">${badge}</span>
            <div class="flex-1 min-w-0">
                <div class="font-semibold text-slate-200 truncate">${mode}</div>
                <div class="text-xs text-slate-500">${date}${r.duration ? " â€” " + fmtDur(r.duration) : ""}</div>
            </div>
            <div class="text-xs text-slate-600 mono">${r.file}</div>
            <span class="text-slate-600">â†’</span>
        `;
          el.onclick = () => loadReport("log/" + r.file);
          list.appendChild(el);
        });
      }

      async function loadReport(url) {
        try {
          const resp = await fetch(url);
          REPORT = await resp.json();
          renderReport();
        } catch (e) {
          alert("Erro ao ler " + url + ": " + e.message);
        }
      }

      function loadReportFromFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          try {
            REPORT = JSON.parse(e.target.result);
            renderReport();
          } catch (err) {
            alert("JSON invÃ¡lido: " + err.message);
          }
        };
        reader.readAsText(file);
      }

      function showFileList() {
        document.getElementById("report-view").style.display = "none";
        document.getElementById("file-list-view").style.display = "block";
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER REPORT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function renderReport() {
        document.getElementById("file-list-view").style.display = "none";
        document.getElementById("report-view").style.display = "block";
        document.getElementById("summary-cards").innerHTML = "";
        document.getElementById("gpu-sections").innerHTML = "";

        const cfg = REPORT.config || {};
        const mode = MODE_LABELS[cfg.mode] || cfg.mode;
        const gpuNames = (cfg.gpus || [])
          .map((g) => "GPU " + g[0] + ": " + g[1])
          .join(", ");

        // Subtitle
        document.getElementById("hdr-subtitle").textContent =
          mode + " â€” " + gpuNames + " â€” " + fmtDur(REPORT.total_elapsed_s || 0);

        // Verdict
        const peakTemps = Object.keys(REPORT)
          .filter((k) => k.match(/^gpu_\d+_peak$/))
          .map((k) => REPORT[k].max_temp_c || 0);
        const peakT = peakTemps.length ? Math.max(...peakTemps) : 0;
        const result = REPORT.result || "";
        const badge = document.getElementById("hdr-verdict");
        if (result.includes("ABORTADO") || peakT >= 95) {
          badge.textContent = "ğŸ”´ REPROVADO";
          badge.className =
            "px-6 py-3 rounded-xl text-xl font-bold text-center bg-red-500/20 text-red-400 border border-red-500/30";
        } else if (peakT >= 85 || result.includes("Interrompido")) {
          badge.textContent = "ğŸŸ¡ ATENÃ‡ÃƒO";
          badge.className =
            "px-6 py-3 rounded-xl text-xl font-bold text-center bg-yellow-500/20 text-yellow-400 border border-yellow-500/30";
        } else {
          badge.textContent = "ğŸŸ¢ APROVADO";
          badge.className =
            "px-6 py-3 rounded-xl text-xl font-bold text-center bg-green-500/20 text-green-400 border border-green-500/30";
        }

        // Summary cards
        const cards = [
          { icon: "ğŸ”§", label: "Modo", value: mode, color: "blue" },
          {
            icon: "â±ï¸",
            label: "DuraÃ§Ã£o",
            value: fmtDur(REPORT.total_elapsed_s || 0),
            color: "purple",
          },
          {
            icon: "ğŸ“…",
            label: "InÃ­cio",
            value: fmtDate(REPORT.test_started),
            color: "slate",
          },
          {
            icon: "ğŸ“Š",
            label: "Amostras",
            value: String((REPORT.snapshots || []).length),
            color: "cyan",
          },
        ];
        const cc = {
          blue: "border-blue-500/20",
          purple: "border-purple-500/20",
          slate: "border-slate-500/20",
          cyan: "border-cyan-500/20",
        };
        const cDiv = document.getElementById("summary-cards");
        cards.forEach((c, i) => {
          const d = document.createElement("div");
          d.className = `glass-card rounded-xl p-5 border ${cc[c.color]} fade-up`;
          d.style.animationDelay = i * 0.06 + "s";
          d.innerHTML = `<div class="text-2xl mb-2">${c.icon}</div>
            <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">${c.label}</div>
            <div class="text-lg font-bold text-slate-200">${c.value}</div>`;
          cDiv.appendChild(d);
        });

        // GPU sections
        google.charts.setOnLoadCallback(() => {
          for (const [idx, name] of cfg.gpus || []) renderGpu(idx, name);
        });

        // Footer
        document.getElementById("footer-info").textContent =
          "GPU Stress Tester â€” " +
          fmtDate(REPORT.test_started) +
          " â€” " +
          (REPORT.snapshots || []).length +
          " amostras";
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• RENDER GPU â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function renderGpu(gpuIdx, gpuName) {
        const snaps = gpuSnaps(gpuIdx);
        if (!snaps.length) return;

        const pk = REPORT[`gpu_${gpuIdx}_peak`] || {};
        const temps = snaps.map((s) => s.temp_c),
          powers = snaps.map((s) => s.power_w),
          utils = snaps.map((s) => s.util_gpu),
          vrams = snaps.map((s) => s.mem_used_gb),
          vramPcts = snaps.map((s) => s.mem_pct),
          fans = snaps.map((s) => s.fan_pct),
          coreClks = snaps.map((s) => s.clock_core_mhz),
          memClks = snaps.map((s) => s.clock_mem_mhz),
          elapsed = snaps.map((s) => s.elapsed_s);

        const tS = calcStats(temps),
          pS = calcStats(powers),
          uS = calcStats(utils),
          vS = calcStats(vrams),
          fS = calcStats(fans);
        const tc = tempColor(tS.max);
        const totalVram = snaps[0]?.mem_total_gb || 0;

        const section = document.createElement("div");
        section.innerHTML = `
    <div class="glass rounded-2xl p-6 fade-up">
        <h2 class="text-2xl font-bold text-white mb-6">ğŸ–¥ï¸ GPU ${gpuIdx}: ${gpuName}</h2>

        <!-- Stat Cards -->
        <div class="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
            <div class="glass-card rounded-xl p-4">
                <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">ğŸŒ¡ï¸ Temp MÃ¡x</div>
                <div class="text-3xl font-black ${tc.txt}">${tS.max}Â°C</div>
                <div class="text-xs text-slate-500 mt-1">avg ${tS.avg}Â°C Â· min ${tS.min}Â°C</div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">âš¡ Power MÃ¡x</div>
                <div class="text-3xl font-black text-yellow-400">${pS.max} W</div>
                <div class="text-xs text-slate-500 mt-1">avg ${pS.avg} W Â· min ${pS.min} W</div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">ğŸ“Š GPU Load</div>
                <div class="text-3xl font-black text-green-400">${uS.avg}%</div>
                <div class="text-xs text-slate-500 mt-1">max ${uS.max}% Â· min ${uS.min}%</div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">ğŸ’¾ VRAM MÃ¡x</div>
                <div class="text-3xl font-black text-purple-400">${vS.max} GB</div>
                <div class="text-xs text-slate-500 mt-1">de ${totalVram} GB total</div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <div class="text-xs uppercase tracking-wider text-slate-500 mb-1">ğŸŒ€ Fan MÃ¡x</div>
                <div class="text-3xl font-black text-cyan-400">${fS.max >= 0 ? fS.max + "%" : "N/A"}</div>
                <div class="text-xs text-slate-500 mt-1">${fS.max >= 0 ? "avg " + fS.avg + "%" : "water cooled?"}</div>
            </div>
        </div>

        <!-- Charts 2x2 -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-400 mb-2">ğŸŒ¡ï¸ Temperatura (Â°C)</h3>
                <div id="ch-temp-${gpuIdx}" class="chart-box"></div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-400 mb-2">âš¡ PotÃªncia (W)</h3>
                <div id="ch-pwr-${gpuIdx}" class="chart-box"></div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-400 mb-2">ğŸ“Š GPU Load (%)</h3>
                <div id="ch-load-${gpuIdx}" class="chart-box"></div>
            </div>
            <div class="glass-card rounded-xl p-4">
                <h3 class="text-sm font-semibold text-slate-400 mb-2">ğŸ’¾ VRAM (GB)</h3>
                <div id="ch-vram-${gpuIdx}" class="chart-box"></div>
            </div>
        </div>

        <!-- Heatmap -->
        <div class="glass-card rounded-xl p-5 mb-8">
            <h3 class="text-sm font-semibold text-slate-400 mb-4">ğŸ—ºï¸ Heatmap Visual</h3>
            <div class="space-y-4">
                <div>
                    <div class="flex items-center gap-3 mb-1">
                        <span class="text-xs text-slate-500 w-20 shrink-0">ğŸŒ¡ï¸ Temp</span>
                        <div class="heatmap-row flex-1" id="hm-temp-${gpuIdx}"></div>
                    </div>
                    <div class="ml-[92px] flex gap-3 text-[11px] text-slate-600">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-cyan-500 inline-block"></span>&lt;60Â°</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-green-500 inline-block"></span>60-70</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-yellow-500 inline-block"></span>70-80</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-orange-500 inline-block"></span>80-90</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-red-500 inline-block"></span>90+</span>
                    </div>
                </div>
                <div>
                    <div class="flex items-center gap-3 mb-1">
                        <span class="text-xs text-slate-500 w-20 shrink-0">ğŸ“Š Load</span>
                        <div class="heatmap-row flex-1" id="hm-load-${gpuIdx}"></div>
                    </div>
                    <div class="ml-[92px] flex gap-3 text-[11px] text-slate-600">
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-red-500 inline-block"></span>&lt;40%</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-yellow-500 inline-block"></span>40-70</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-green-500 inline-block"></span>70-95</span>
                        <span class="flex items-center gap-1"><span class="w-3 h-3 rounded bg-emerald-400 inline-block"></span>95%+</span>
                    </div>
                </div>
                <div>
                    <div class="flex items-center gap-3">
                        <span class="text-xs text-slate-500 w-20 shrink-0">âš¡ Power</span>
                        <div class="heatmap-row flex-1" id="hm-pwr-${gpuIdx}"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Data Table -->
        <div class="glass-card rounded-xl overflow-hidden">
            <table class="w-full text-sm">
                <thead><tr class="border-b border-slate-700/50 text-xs uppercase tracking-wider">
                    <th class="text-left p-3 text-slate-500">MÃ©trica</th>
                    <th class="text-right p-3 text-green-500">MÃ­n</th>
                    <th class="text-right p-3 text-yellow-500">MÃ©dia</th>
                    <th class="text-right p-3 text-red-500">MÃ¡x</th>
                </tr></thead>
                <tbody id="tbl-${gpuIdx}" class="mono text-sm"></tbody>
            </table>
        </div>
    </div>`;

        document.getElementById("gpu-sections").appendChild(section);

        // Fill table
        const rows = [
          ["ğŸŒ¡ï¸ Temperatura", temps, "Â°C"],
          ["âš¡ PotÃªncia", powers, " W"],
          ["ğŸ“Š GPU Load", utils, "%"],
          ["ğŸ“Š Mem Bus", snaps.map((s) => s.util_mem), "%"],
          ["ğŸ’¾ VRAM", vrams, " GB"],
          ["ğŸ’¾ VRAM %", vramPcts, "%"],
          ["ğŸŒ€ Fan", fans.filter((f) => f >= 0), "%"],
          ["ğŸ• Core Clk", coreClks, " MHz"],
          ["ğŸ• Mem Clk", memClks, " MHz"],
        ];
        const tbody = document.getElementById(`tbl-${gpuIdx}`);
        rows.forEach(([label, vals, unit]) => {
          if (!vals.length) return;
          const s = calcStats(vals);
          const tr = document.createElement("tr");
          tr.className =
            "border-b border-slate-800/50 hover:bg-slate-800/30 transition-colors";
          tr.innerHTML = `<td class="p-3 text-slate-300">${label}</td>
            <td class="p-3 text-right text-green-400">${s.min}${unit}</td>
            <td class="p-3 text-right text-yellow-400">${s.avg}${unit}</td>
            <td class="p-3 text-right text-red-400">${s.max}${unit}</td>`;
          tbody.appendChild(tr);
        });

        // Heatmaps
        fillHeatmap(`hm-temp-${gpuIdx}`, temps, [
          [90, "#ef4444"],
          [80, "#f97316"],
          [70, "#eab308"],
          [60, "#22c55e"],
          [0, "#06b6d4"],
        ]);
        fillHeatmap(`hm-load-${gpuIdx}`, utils, [
          [95, "#34d399"],
          [70, "#22c55e"],
          [40, "#eab308"],
          [0, "#ef4444"],
        ]);
        fillHeatmapRel(`hm-pwr-${gpuIdx}`, powers, pS.max, [
          [0.9, "#ef4444"],
          [0.7, "#eab308"],
          [0.4, "#22c55e"],
          [0, "#334155"],
        ]);

        // Charts
        drawChart(
          `ch-temp-${gpuIdx}`,
          elapsed,
          temps,
          "Â°C",
          "#f97316",
          [tS.min - 5, tS.max + 5],
          "line",
        );
        drawChart(
          `ch-pwr-${gpuIdx}`,
          elapsed,
          powers,
          "W",
          "#eab308",
          [0, pS.max * 1.15],
          "line",
        );
        drawChart(
          `ch-load-${gpuIdx}`,
          elapsed,
          utils,
          "%",
          "#22c55e",
          [0, 105],
          "line",
        );
        drawChart(
          `ch-vram-${gpuIdx}`,
          elapsed,
          vrams,
          "GB",
          "#a855f7",
          [0, totalVram * 1.05],
          "area",
        );
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• HEATMAP â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function fillHeatmap(id, vals, thresholds) {
        const c = document.getElementById(id);
        if (!c) return;
        const maxB = 250,
          step = Math.max(1, Math.floor(vals.length / maxB));
        for (let i = 0; i < vals.length; i += step) {
          const v = vals[i];
          let color = thresholds[thresholds.length - 1][1];
          for (const [lim, col] of thresholds) {
            if (v >= lim) {
              color = col;
              break;
            }
          }
          const d = document.createElement("div");
          d.style.backgroundColor = color;
          d.title = v + "";
          c.appendChild(d);
        }
      }
      function fillHeatmapRel(id, vals, mx, thresholds) {
        const c = document.getElementById(id);
        if (!c) return;
        const maxB = 250,
          step = Math.max(1, Math.floor(vals.length / maxB));
        for (let i = 0; i < vals.length; i += step) {
          const r = mx > 0 ? vals[i] / mx : 0;
          let color = thresholds[thresholds.length - 1][1];
          for (const [lim, col] of thresholds) {
            if (r >= lim) {
              color = col;
              break;
            }
          }
          const d = document.createElement("div");
          d.style.backgroundColor = color;
          d.title = vals[i] + " W";
          c.appendChild(d);
        }
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• GOOGLE CHARTS â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      function drawChart(id, xVals, yVals, label, color, range, type) {
        const data = new google.visualization.DataTable();
        data.addColumn("number", "Tempo (s)");
        data.addColumn("number", label);
        for (let i = 0; i < xVals.length; i++)
          data.addRow([xVals[i], yVals[i]]);

        const opts = {
          backgroundColor: "transparent",
          chartArea: {
            left: 55,
            top: 15,
            right: 15,
            bottom: 35,
            width: "100%",
            height: "80%",
          },
          colors: [color],
          legend: "none",
          lineWidth: 2,
          curveType: "function",
          areaOpacity: type === "area" ? 0.2 : 0,
          hAxis: {
            title: "Tempo (s)",
            textStyle: { color: "#64748b", fontSize: 10 },
            titleTextStyle: { color: "#64748b", fontSize: 11 },
            gridlines: { color: "#1e293b" },
            baselineColor: "#1e293b",
          },
          vAxis: {
            viewWindow: { min: range[0], max: range[1] },
            textStyle: { color: "#64748b", fontSize: 10 },
            gridlines: { color: "#1e293b" },
            baselineColor: "#1e293b",
          },
          tooltip: { textStyle: { fontSize: 12 } },
          crosshair: {
            trigger: "both",
            orientation: "vertical",
            color: "#475569",
            opacity: 0.3,
          },
        };

        const ChartClass =
          type === "area"
            ? google.visualization.AreaChart
            : google.visualization.LineChart;
        new ChartClass(document.getElementById(id)).draw(data, opts);
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• FILE INPUT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      document.getElementById("file-input").addEventListener("change", (e) => {
        if (e.target.files[0]) loadReportFromFile(e.target.files[0]);
      });

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• INIT â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      google.charts.load("current", { packages: ["corechart"] });
      google.charts.setOnLoadCallback(init);
    </script>
  </body>
</html>
